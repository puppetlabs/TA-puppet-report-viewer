<form script="overview.js,tokenlink.js" theme="light">
  <label>Overview</label>
  <description>Report data generated by Puppet</description>
  <fieldset submitButton="false">
    <input type="time" token="overviewTimeRange" searchWhenChanged="true">
      <label>Time range:</label>
      <default>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </default>
    </input>
    <input type="dropdown" token="pe_console" searchWhenChanged="true">
      <label>Puppet Install</label>
      <choice value="*">All</choice>
      <default>*</default>
      <prefix>pe_console="</prefix>
      <suffix>"</suffix>
      <initialValue>*</initialValue>
      <fieldForLabel>pe_console</fieldForLabel>
      <fieldForValue>pe_console</fieldForValue>
      <search>
        <query>`puppet_facts_index` sourcetype="puppet:facts" | dedup pe_console | table pe_console</query>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </search>
    </input>
  </fieldset>
  <row>
    <panel>
      <title></title>
      <html>
        <b>Managed Hosts by Environment</b>
        </html>
      <single>
        <search>
          <query>`puppet_summary_index` sourcetype="puppet:summary" $pe_console$
| stats count by host 
| stats count</query>
          <earliest>$overviewTimeRange.earliest$</earliest>
          <latest>$overviewTimeRange.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="colorBy">value</option>
        <option name="colorMode">none</option>
        <option name="drilldown">all</option>
        <option name="field">count</option>
        <option name="height">76</option>
        <option name="numberPrecision">0</option>
        <option name="rangeColors">["0x53a051","0x0877a6","0xf8be34","0xf1813f","0xdc4e41"]</option>
        <option name="rangeValues">[0,30,70,100]</option>
        <option name="refresh.display">preview</option>
        <option name="showSparkline">1</option>
        <option name="showTrendIndicator">1</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
        <option name="trendColorInterpretation">standard</option>
        <option name="trendDisplayMode">absolute</option>
        <option name="unit">hosts</option>
        <option name="unitPosition">after</option>
        <option name="useColors">0</option>
        <option name="useThousandSeparators">1</option>
        <drilldown>
          <set token="title1">$row.certname$</set>
        </drilldown>
      </single>
    </panel>
    <panel>
      <title></title>
      <html>
        <b>Hosts with corrective changes</b>
        </html>
      <single>
        <search>
          <query>`puppet_summary_index` sourcetype="puppet:summary" $pe_console$
| search corrective_change=true
| dedup certname 
| stats count(corrective_change) by _time</query>
          <earliest>$overviewTimeRange.earliest$</earliest>
          <latest>$overviewTimeRange.latest$</latest>
          <refresh>10m</refresh>
          <refreshType>delay</refreshType>
        </search>
        <option name="drilldown">all</option>
        <option name="rangeColors">["0x53a051","0x0877a6","0xf8be34","0xf1813f","0xdc4e41"]</option>
        <option name="refresh.display">preview</option>
        <option name="showSparkline">1</option>
        <option name="showTrendIndicator">1</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.size">large</option>
        <option name="trellis.splitBy">_aggregation</option>
        <option name="trendDisplayMode">percent</option>
        <option name="trendInterval">-24h</option>
        <option name="underLabel">hosts with corrective changes</option>
        <option name="useColors">0</option>
        <drilldown>
          <set token="title2">$row.click$</set>
        </drilldown>
      </single>
    </panel>
    <panel>
      <title></title>
      <html>
        <b>Hosts with failures</b>
        </html>
      <single>
        <search>
          <query>`puppet_summary_index` sourcetype="puppet:summary" $pe_console$
| search status=failed
| dedup certname 
| stats count(status) by _time</query>
          <earliest>$overviewTimeRange.earliest$</earliest>
          <latest>$overviewTimeRange.latest$</latest>
          <refresh>10m</refresh>
          <refreshType>delay</refreshType>
        </search>
        <option name="drilldown">all</option>
        <option name="rangeColors">["0x53a051","0x0877a6","0xf8be34","0xf1813f","0xdc4e41"]</option>
        <option name="refresh.display">preview</option>
        <option name="showSparkline">1</option>
        <option name="trendDisplayMode">percent</option>
        <option name="underLabel">hosts with failures</option>
        <drilldown>
          <set token="title3">$row.click$</set>
        </drilldown>
      </single>
    </panel>
  </row>
  <row>
    <panel depends="$title2$">
      <table>
        <search>
          <query>`puppet_summary_index` sourcetype="puppet:summary" $pe_console$
| search corrective_change=true
| dedup certname 
| stats count(corrective_change) by host | rename count(corrective_change) as "Corrective Changes" host as Host</query>
          <earliest>$overviewTimeRange.earliest$</earliest>
          <latest>$overviewTimeRange.latest$</latest>
        </search>
        <option name="count">10</option>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </table>
    </panel>
  </row>
  <row>
    <panel depends="$title3$">
      <table>
        <title>Host with Failures</title>
        <search>
          <query>`puppet_summary_index` sourcetype="puppet:summary" $pe_console$
| search status=failed 
| dedup 1 certname
| eval "certname"=mvdedup('certname'),"run_time"=mvdedup('metrics.time.total')
| eval strf_time=strftime(_time, "%Y-%m-%d %T %:z")
| eval run_time_rnd=round(run_time,1)
| rename certname as "Host"
| rename strf_time as "Report Time"
| rename run_time_rnd as "Execution Time (seconds)"
| sort -"Report Time"
| table Host, "Report Time", "Execution Time (seconds)"</query>
          <earliest>$overviewTimeRange.earliest$</earliest>
          <latest>$overviewTimeRange.latest$</latest>
        </search>
        <option name="count">10</option>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <table depends="$title1$">
        <search>
          <query>`puppet_summary_index` sourcetype="puppet:summary" $pe_console$ |dedup host | stats sparkline  avg(metrics.time.catalog_application) as Application avg(metrics.time.config_retrieval) as Retrieval avg(metrics.time.fact_generation) as Generation avg(metrics.time.total) as Total by host  | table host sparkline Application Retrieval Generation Total</query>
          <earliest>$overviewTimeRange.earliest$</earliest>
          <latest>$overviewTimeRange.latest$</latest>
        </search>
        <option name="count">10</option>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <chart>
        <search>
          <query>`puppet_summary_index` sourcetype="puppet:summary" $pe_console$ host != producer | timechart span=30m avg(metrics.time.catalog_application) AS Catalog avg(metrics.time.config_retrieval) as Retrieval avg(metrics.time.fact_generation) as Generation avg(metrics.time.total) as Total | predict Total</query>
          <earliest>$overviewTimeRange.earliest$</earliest>
          <latest>$overviewTimeRange.latest$</latest>
        </search>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.nullValueMode">connect</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.placement">right</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">0</option>
        <option name="trellis.size">medium</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <html>
        <b># of Resources</b>                                                                        <button class="btn" align="right" data-unset-token="title5">X</button>
        </html>
      <single>
        <search>
          <query>`puppet_summary_index` sourcetype="puppet:summary" $pe_console$ | stats count(metrics.changes.total)</query>
          <earliest>$overviewTimeRange.earliest$</earliest>
          <latest>$overviewTimeRange.latest$</latest>
        </search>
        <option name="drilldown">all</option>
        <option name="rangeColors">["0x53a051","0x0877a6","0xf8be34","0xf1813f","0xdc4e41"]</option>
        <option name="refresh.display">progressbar</option>
        <option name="showSparkline">0</option>
        <option name="showTrendIndicator">1</option>
        <option name="trendDisplayMode">absolute</option>
        <option name="trendInterval">-7d</option>
        <drilldown>
          <set token="title5">$row.click$</set>
        </drilldown>
      </single>
    </panel>
    <panel>
      <title></title>
      <html>
        <b>All reports</b>
        </html>
      <single>
        <search>
          <query>`puppet_summary_index` sourcetype="puppet:summary" $pe_console$ | stats count</query>
          <earliest>$overviewTimeRange.earliest$</earliest>
          <latest>$overviewTimeRange.latest$</latest>
        </search>
        <option name="drilldown">all</option>
        <option name="field">count</option>
        <option name="height">70</option>
        <option name="rangeColors">["0x53a051","0x0877a6","0xf8be34","0xf1813f","0xdc4e41"]</option>
        <option name="refresh.display">preview</option>
        <option name="unit">reports</option>
        <option name="unitPosition">after</option>
        <drilldown>
          <set token="title6">$row.click$</set>
        </drilldown>
      </single>
    </panel>
    <panel>
      <title></title>
      <html>
        <b>Average Compilation Times</b>
        </html>
      <single>
        <search>
          <query>`puppet_summary_index` sourcetype="puppet:summary" $pe_console$ | stats avg("metrics.time.total") | rename host as "Host" avg(metrics.time.total) as "Total Time"</query>
          <earliest>$overviewTimeRange.earliest$</earliest>
          <latest>$overviewTimeRange.latest$</latest>
        </search>
        <option name="drilldown">all</option>
        <option name="numberPrecision">0.00</option>
        <option name="rangeColors">["0x53a051","0x0877a6","0xf8be34","0xf1813f","0xdc4e41"]</option>
        <option name="refresh.display">progressbar</option>
        <drilldown>
          <set token="title4">$row.click$</set>
        </drilldown>
      </single>
    </panel>
  </row>
  <row>
    <panel>
      <table depends="$title4$">
        <title>Average Compilation Times</title>
        <search>
          <query>`puppet_summary_index` sourcetype="puppet:summary" $pe_console$ | stats avg("metrics.time.total") latest(time) by host | rename host as "Host" avg(metrics.time.total) as "Total Time" latest(time) as "Report Time"  | table "Host" "Total Time" "Report Time"</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
        </search>
        <option name="count">10</option>
        <option name="dataOverlayMode">heatmap</option>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">true</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <table depends="$title5$">
        <title></title>
        <search>
          <query>`puppet_summary_index` sourcetype="puppet:summary" pe_console="*" | stats count(metrics.changes.total) by host | rename host as Host count(metrics.changes.total) as Total</query>
          <earliest>$overviewTimeRange.earliest$</earliest>
          <latest>$overviewTimeRange.latest$</latest>
        </search>
        <option name="drilldown">none</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <table depends="$title6$">
        <search>
          <query>`puppet_summary_index` sourcetype="puppet:summary" $pe_console$ | table host status time transaction_uuid</query>
          <earliest>$overviewTimeRange.earliest$</earliest>
          <latest>$overviewTimeRange.latest$</latest>
        </search>
        <option name="count">10</option>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </table>
    </panel>
  </row>
</form>